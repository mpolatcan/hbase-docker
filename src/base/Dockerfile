ARG JAVA_VERSION=""

FROM openjdk:${JAVA_VERSION}-slim

MAINTAINER Mutlu Polatcan <mutlupolatcan@gmail.com>

ENV HDUSER_HOME "/home/hduser"
ENV HBASE_HOME "${HDUSER_HOME}/hbase"
ENV HBASE_CONF_DIR="${HBASE_HOME}/conf" \
    PATH=$PATH:${HBASE_HOME}/bin \
    HBASE_DAEMONS="NULL" \
    HBASE_MANAGES_ZK="false" \
    HBASE_HEAP_SIZE="NULL" \
    HBASE_OFFHEAP_SIZE="NULL" \
	HBASE_ROOTDIR_PERMS="700" \
	HBASE_CLUSTER_DISTRIBUTED="true" \
	HBASE_ZOOKEEPER_QUORUM="localhost" \
	HBASE_ZOOKEEPER_RECOVERY_RETRY_MAXSLEEPTIME="60000" \
	HBASE_ZOOKEEPER_DNS_INTERFACE="default" \
	HBASE_ZOOKEEPER_DNS_NAMESERVER="default" \
	HBASE_ZOOKEEPER_PEERPORT="2888" \
	HBASE_ZOOKEEPER_LEADERPORT="3888" \
	HBASE_ZOOKEEPER_PROPERTY_INITLIMIT="10" \
	HBASE_ZOOKEEPER_PROPERTY_SYNCLIMIT="5" \
	HBASE_ZOOKEEPER_PROPERTY_CLIENTPORT="2181" \
	HBASE_ZOOKEEPER_PROPERTY_MAXCLIENTCNXNS="300" \
	HBASE_MASTER_HOSTNAME="NULL" \
	HBASE_MASTER_PORT="16000" \
	HBASE_MASTER_INFO_PORT="16010" \
	HBASE_MASTER_INFO_BINDADDRESS="0.0.0.0" \
	HBASE_MASTER_LOGCLEANER_PLUGINS="org.apache.hadoop.hbase.master.cleaner.TimeToLiveLogCleaner,org.apache.hadoop.hbase.master.cleaner.TimeToLiveProcedureWALCleaner" \
	HBASE_MASTER_LOGCLEANER_TTL="600000" \
	HBASE_MASTER_PROCEDUREWALCLEANER_TTL="604800000" \
	HBASE_MASTER_HFILECLEANER_PLUGINS="org.apache.hadoop.hbase.master.cleaner.TimeToLiveHFileCleaner" \
	HBASE_MASTER_INFOSERVER_REDIRECT="true" \
	HBASE_MASTER_FILESPLITTIMEOUT="600000" \
	HBASE_MASTER_BALANCER_MAXRITPERCENT="1.0" \
	HBASE_MASTER_KEYTAB_FILE="NULL" \
	HBASE_MASTER_KERBEROS_PRINCIPAL="NULL" \
	HBASE_MASTER_LOADBALANCER_CLASS="org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer" \
	HBASE_MASTER_LOADBALANCE_BYTABLE="false" \
	HBASE_MASTER_NORMALIZER_CLASS="org.apache.hadoop.hbase.master.normalizer.SimpleRegionNormalizer" \
	HBASE_MASTER_MOB_TTL_CLEANER_PERIOD="86400" \
	HBASE_MASTER_WAIT_ON_SERVICE_SECONDS="30" \
	HBASE_MASTER_CLEANER_SNAPSHOT_INTERVAL="1800000" \
	HBASE_MASTER_SNAPSHOT_TTL="0" \
	HBASE_MASTER_REGIONS_RECOVERY_CHECK_INTERVAL="1200000" \
	HBASE_REGIONSERVER_HOSTNAME_DISABLE_MASTER_REVERSEDNS="false" \
	HBASE_REGIONSERVER_PORT="16020" \
	HBASE_REGIONSERVER_INFO_PORT="16030" \
	HBASE_REGIONSERVER_INFO_PORT_AUTO="false" \
	HBASE_REGIONSERVER_INFO_BINDADDRESS="0.0.0.0" \
	HBASE_REGIONSERVER_HANDLER_COUNT="30" \
	HBASE_REGIONSERVER_HANDLER_ABORT_ON_ERROR_PERCENT="0.5" \
	HBASE_REGIONSERVER_MSGINTERVAL="3000" \
	HBASE_REGIONSERVER_LOGROLL_PERIOD="3600000" \
	HBASE_REGIONSERVER_LOGROLL_ERRORS_TOLERATED="2" \
	HBASE_REGIONSERVER_HLOG_READER_IMPL="org.apache.hadoop.hbase.regionserver.wal.ProtobufLogReader" \
	HBASE_REGIONSERVER_HLOG_WRITER_IMPL="org.apache.hadoop.hbase.regionserver.wal.ProtobufLogWriter" \
	HBASE_REGIONSERVER_GLOBAL_MEMSTORE_SIZE="NULL" \
	HBASE_REGIONSERVER_GLOBAL_MEMSTORE_SIZE_LOWER_LIMIT="NULL" \
	HBASE_REGIONSERVER_OPTIONALCACHEFLUSHINTERVAL="3600000" \
	HBASE_REGIONSERVER_DNS_INTERFACE="default" \
	HBASE_REGIONSERVER_DNS_NAMESERVER="default" \
	HBASE_REGIONSERVER_REGION_SPLIT_POLICY="org.apache.hadoop.hbase.regionserver.SteppingSplitPolicy" \
	HBASE_REGIONSERVER_REGIONSPLITLIMIT="1000" \
	HBASE_REGIONSERVER_COMPACTION_ENABLED="true" \
	HBASE_REGIONSERVER_OFFHEAP_GLOBAL_MEMSTORE_SIZE="0" \
	HBASE_REGIONSERVER_THREAD_COMPACTION_THROTTLE="2684354560" \
	HBASE_REGIONSERVER_MAJORCOMPACTION_PAGECACHE_DROP="true" \
	HBASE_REGIONSERVER_MINORCOMPACTION_PAGECACHE_DROP="true" \
	HBASE_REGIONSERVER_KEYTAB_FILE="NULL" \
	HBASE_REGIONSERVER_KERBEROS_PRINCIPAL="NULL" \
	HBASE_REGIONSERVER_THRIFT_FRAMED="false" \
	HBASE_REGIONSERVER_THRIFT_FRAMED_MAX_FRAME_SIZE_IN_MB="2" \
	HBASE_REGIONSERVER_THRIFT_COMPACT="false" \
	HBASE_REGIONSERVER_THRIFT_HTTP="NULL" \
	HBASE_REGIONSERVER_THRIFT_SUPPORT_PROXYUSER="NULL" \
	HBASE_REGIONSERVER_CHECKSUM_VERIFY="true" \
	HBASE_REGIONSERVER_STOREFILE_REFRESH_PERIOD="0" \
	HBASE_IPC_SERVER_CALLQUEUE_HANDLER_FACTOR="0.1" \
	HBASE_IPC_SERVER_CALLQUEUE_READ_RATIO="0" \
	HBASE_IPC_SERVER_CALLQUEUE_SCAN_RATIO="0" \
	HBASE_IPC_SERVER_FALLBACK_TO_SIMPLE_AUTH_ALLOWED="false" \
	HBASE_IPC_CLIENT_TCPNODELAY="true" \
	HBASE_IPC_CLIENT_FALLBACK_TO_SIMPLE_AUTH_ALLOWED="false" \
	HBASE_SYSTEMTABLES_COMPACTING_MEMSTORE_TYPE="NONE" \
	HBASE_CLIENT_WRITE_BUFFER="2097152" \
	HBASE_CLIENT_PAUSE="100" \
	HBASE_CLIENT_PAUSE_CQTBE="NULL" \
	HBASE_CLIENT_RETRIES_NUMBER="15" \
	HBASE_CLIENT_MAX_TOTAL_TASKS="100" \
	HBASE_CLIENT_MAX_PERSERVER_TASKS="2" \
	HBASE_CLIENT_MAX_PERREGION_TASKS="1" \
	HBASE_CLIENT_PERSERVER_REQUESTS_THRESHOLD="2147483647" \
	HBASE_CLIENT_SCANNER_CACHING="2147483647" \
	HBASE_CLIENT_SCANNER_TIMEOUT_PERIOD="60000" \
	HBASE_CLIENT_SCANNER_MAX_RESULT_SIZE="2097152" \
	HBASE_CLIENT_KEYVALUE_MAXSIZE="10485760" \
	HBASE_CLIENT_LOCALITYCHECK_THREADPOOLSIZE="2" \
	HBASE_CLIENT_OPERATION_TIMEOUT="1200000" \
	HBASE_CLIENT_KEYTAB_FILE="NULL" \
	HBASE_CLIENT_KEYTAB_PRINCIPAL="NULL" \
	HBASE_SERVER_KEYVALUE_MAXSIZE="10485760" \
	HBASE_SERVER_THREAD_WAKEFREQUENCY="10000" \
	HBASE_SERVER_VERSIONFILE_WRITEATTEMPTS="3" \
	HBASE_SERVER_COMPACTCHECKER_INTERVAL_MULTIPLIER="1000" \
	HBASE_SERVER_SCANNER_MAX_RESULT_SIZE="104857600" \
	HBASE_BULKLOAD_RETRIES_NUMBER="10" \
	HBASE_BALANCER_PERIOD="300000" \
	HBASE_NORMALIZER_PERIOD="300000" \
	HBASE_NORMALIZER_MIN_REGION_COUNT="3" \
	HBASE_REGIONS_SLOP="0.001" \
	HBASE_REGIONS_RECOVERY_STORE_FILE_REF_COUNT="-1" \
	HBASE_HREGION_MEMSTORE_FLUSH_SIZE="134217728" \
	HBASE_HREGION_MEMSTORE_BLOCK_MULTIPLIER="4" \
	HBASE_HREGION_MEMSTORE_MSLAB_ENABLED="true" \
	HBASE_HREGION_MEMSTORE_MSLAB_CHUNKSIZE="2097152" \
	HBASE_HREGION_MEMSTORE_MSLAB_MAX_ALLOCATION="262144" \
	HBASE_HREGION_PERCOLUMNFAMILYFLUSH_SIZE_LOWER_BOUND_MIN="16777216" \
	HBASE_HREGION_PRECLOSE_FLUSH_SIZE="5242880" \
	HBASE_HREGION_MAX_FILESIZE="10737418240" \
	HBASE_HREGION_MAJORCOMPACTION="604800000" \
	HBASE_HREGION_MAJORCOMPACTION_JITTER="0.50" \
	HBASE_HSTORE_COMPACTIONTHRESHOLD="3" \
	HBASE_HSTORE_FLUSHER_COUNT="2" \
	HBASE_HSTORE_BLOCKINGSTOREFILES="16" \
	HBASE_HSTORE_BLOCKINGWAITTIME="90000" \
	HBASE_HSTORE_COMPACTION_MIN="3" \
	HBASE_HSTORE_COMPACTION_MIN_SIZE="134217728" \
	HBASE_HSTORE_COMPACTION_MAX="10" \
	HBASE_HSTORE_COMPACTION_MAX_SIZE="9223372036854775807" \
	HBASE_HSTORE_COMPACTION_RATIO="1.2F" \
	HBASE_HSTORE_COMPACTION_RATIO_OFFPEAK="5.0F" \
	HBASE_HSTORE_COMPACTION_KV_MAX="10" \
	HBASE_HSTORE_COMPACTION_THROUGHPUT_LOWER_BOUND="52428800" \
	HBASE_HSTORE_COMPACTION_THROUGHPUT_HIGHER_BOUND="104857600" \
	HBASE_HSTORE_TIME_TO_PURGE_DELETES="0" \
	HBASE_HSTORE_BYTES_PER_CHECKSUM="16384" \
	HBASE_HSTORE_CHECKSUM_ALGORITHM="CRC32C" \
	HBASE_OFFPEAK_START_HOUR="-1" \
	HBASE_OFFPEAK_END_HOIR="-1" \
	HBASE_STORESCANNER_PARALLEL_SEEK_ENABLE="false" \
	HBASE_STORESCANNER_PARALLEL_SEEK_THREADS="10" \
	HBASE_BUCKETCACHE_IOENGINE="NULL" \
	HBASE_BUCKETCACHE_SIZE="NULL" \
	HBASE_BUCKETCACHE_BUCKET_SIZES="NULL" \
	HBASE_RS_CACHEBLOCKSONWRITE="false" \
	HBASE_RPC_TIMEOUT="60000" \
	HBASE_RPC_SHORTOPERATION_TIMEOUT="10000" \
	HBASE_RPC_ROWS_WARNING_THRESHOLD="5000" \
	HBASE_RPC_PROTECTION="NULL" \
	HBASE_RPC_ENGINE="NULL" \
	HBASE_CELLS_SCANNED_PER_HEARTBEAT_CHECK="10000" \
	HBASE_SUPERUSER="NULL" \
	HBASE_AUTH_KEY_UPDATE_INTERVAL="86400000" \
	HBASE_AUTH_TOKEN_MAX_LIFETIME="604800000" \
	HBASE_DISPLAY_KEYS="true" \
	HBASE_COPROCESSOR_ENABLED="true" \
	HBASE_COPROCESSOR_USER_ENABLED="true" \
	HBASE_COPROCESSOR_REGION_CLASSES="NULL" \
	HBASE_COPROCESSOR_REGIONSERVER_CLASSES="NULL" \
	HBASE_COPROCESSOR_MASTER_CLASSSES="NULL" \
	HBASE_COPROCESSOR_ABORTONERROR="true" \
	HBASE_REST_PORT="8080" \
	HBASE_REST_READONLY="false" \
	HBASE_REST_THREADS_MAX="100" \
	HBASE_REST_THREADS_MIN="2" \
	HBASE_REST_SUPPORT_PROXYUSER="false" \
	HBASE_REST_FILTER_CLASSES="org.apache.hadoop.hbase.rest.filter.GzipFilter" \
	HBASE_REST_CSRF_ENABLED="false" \
	HBASE_REST_KEYTAB_FILE="NULL" \
	HBASE_REST_KERBEROS_PRINCIPAL="NULL" \
	HBASE_DEFAULTS_FOR_VERSION_SKIP="false" \
	HBASE_TABLE_LOCK_ENABLE="true" \
	HBASE_TABLE_MAX_ROWSIZE="1073741824" \
	HBASE_THRIFT_MINWORKERTHREADS="16" \
	HBASE_THRIFT_MAXWORKERTHREADS="1000" \
	HBASE_THRIFT_MAXQUEUEDREQUESTS="1000" \
	HBASE_THRIFT_KEYTAB_FILE="NULL" \
	HBASE_THRIFT_KERBEROS_PRINCIPAL="NULL" \
	HBASE_THRIFT_DNS_INTERFACE="NULL" \
	HBASE_THRIFT_DNS_NAMESERVER="NULL" \
	HBASE_WAL_DIR_PERMS="700" \
	HBASE_WAL_PROVIDER="NULL" \
	HBASE_DATA_UMASK="000" \
	HBASE_DATA_UMASK_ENABLE="false" \
	HBASE_SNAPSHOT_ENABLED="true" \
	HBASE_SNAPSHOT_RESTORE_TAKE_FAILSAFE_SNAPSHOT="true" \
	HBASE_SNAPSHOT_RESTORE_FAILSAFE_NAME="hbase-failsafe-{snapshot.name}-{restore.timestamp}" \
	HBASE_SNAPSHOT_WORKING_DIR="NULL" \
	HBASE_SNAPSHOT_MASTER_TIMEOUT_MILLIS="300000" \
	HBASE_SNAPSHOT_REGION_TIMEOUT="300000" \
	HBASE_LEASE_RECOVERY_TIMEOUT="900000" \
	HBASE_LEASE_RECOVERY_DFS_TIMEOUT="64000" \
	HBASE_COLUMN_MAX_VERSION="1" \
	HBASE_DFS_CLIENT_READ_SHORTCIRCUIT_BUFFER_SIZE="131072" \
	HBASE_STATUS_PUBLISHED="false" \
	HBASE_STATUS_PUBLISHER_CLASS="org.apache.hadoop.hbase.master.ClusterStatusPublisher\$MulticastPublisher" \
	HBASE_STATUS_LISTENER_CLASS="org.apache.hadoop.hbase.client.ClusterStatusListener\$MulticastListener" \
	HBASE_STATUS_MULTICAST_ADDRESS_IP="226.1.1.3" \
	HBASE_STATUS_MULTICAST_ADDRESS_PORT="16100" \
	HBASE_SECURITY_AUTHENTICATION="simple" \
	HBASE_SECURITY_AUTHENTICATION_UI="NULL" \
	HBASE_SECURITY_AUTHENTICATION_SPNEGO_KERBEROS_PRINCIPAL="NULL" \
	HBASE_SECURITY_AUTHENTICATION_SPNEGO_KERBEROS_KEYTAB="NULL" \
	HBASE_SECURITY_AUTHENTICATION_SPNEGO_KERBEROS_NAME_RULE="NULL" \
	HBASE_SECURITY_AUTHENTICATION_SIGNATURE_SECRET_FILE="NULL" \
	HBASE_SECURITY_AUTHORIZATION="NULL" \
	HBASE_SECURITY_EXEC_PERMISSION_CHECKS="false" \
	HBASE_REST_CSRF_BROWSER_USERAGENTS_REGEX="Mozilla.,Opera." \
	HBASE_REST_CSRF_VISIBILITY_MUTATIONS_CHECKAUTHS="false" \
	HBASE_PROCEDURE_REGIONSERVER_CLASSES="NULL" \
	HBASE_PROCEDURE_MASTER_CLASSES="NULL" \
	HBASE_PROCEDURE_STORE_WAL_PERIODIC_ROLL_MSEC="3600000" \
	HBASE_PROCEDURE_STORE_WAL_ROLL_THRESHOLD="33554432" \
	HBASE_PROCEDURE_STORE_WAL_WARN_THRESHOLD="64" \
	HBASE_PROCEDURE_STORE_WAL_MAX_RETRIES_BEFORE_ROLL="100" \
	HBASE_PROCEDURE_STORE_WAL_SYNC_FAILURE_ROLL_MAX="100" \
	HBASE_COORDINATED_STATE_MANAGER_CLASS="org.apache.hadoop.hbase.coordination.ZkCoordinatedStateManager" \
	HBASE_REGION_REPLICA_REPLICATION_ENABLED="false" \
	HBASE_HTTP_FILTER_INITIALIZERS="org.apache.hadoop.hbase.http.lib.StaticUserWebFilter" \
	HBASE_HTTP_MAX_THREADS="16" \
	HBASE_HTTP_STATICUSER_USER="dr.stack" \
	HBASE_REPLICATION_RPC_CODEC="org.apache.hadoop.hbase.codec.KeyValueCodecWithTags" \
	HBASE_REPLICATION_SOURCE_MAXTHREADS="10" \
	HBASE_MOB_FILE_CACHE_SIZE="1000" \
	HBASE_MOB_CACHE_EVICT_PERIOD="3600" \
	HBASE_MOB_CACHE_EVICT_REMAIN_RATIO="0.5f" \
	HBASE_MOB_COMPACTION_MERGEABLE_THRESHOLD="1342177280" \
	HBASE_MOB_COMPACTION_BATCH_SIZE="100" \
	HBASE_MOB_COMPACTION_CHORE_PERIOD="604800" \
	HBASE_MOB_COMPACTION_THREADS_MAX="1" \
	HBASE_MOB_DELFILE_MAX_COUNT="3" \
	HBASE_MOB_COMPACTOR_CLASS="org.apache.hadoop.hbase.mob.compactions.PartitionedMobCompactor" \
	HBASE_STORE_DELETE_EXPIRED_STOREFILE="NULL" \
	ZOOKEEPER_SESSION_TIMEOUT="90000" \
	ZOOKEEPER_ZNODE_PARENT="/hbase" \
	ZOOKEEPER_ZNODE_ACL_PARENT="acl" \
	HFILE_BLOCK_CACHE_POLICY="LRU" \
	HFILE_BLOCK_CACHE_SIZE="0.4" \
	HFILE_BLOCK_INDEX_CACHEONWRITE="false" \
	HFILE_BLOCK_BLOOM_CACHEONWRITE="false" \
	HFILE_INDEX_BLOCK_MAX_SIZE="131072" \
	HFILE_FORMAT_VERSION="3" \
	IO_STOREFILE_BLOOM_BLOCK_SIZE="131072" \
	HADOOP_POLICY_FILE="hbase-policy.xml" \
	DFS_NAMENODE_HOSTNAME="NULL" \
	DFS_NAMENODE_RPC_PORT="9000" \
	DFS_CLIENT_READ_SHORTCIRCUIT="false" \
	DFS_CLIENT_READ_SHORTCIRCUIT_SKIP_CHECKSUM="NULL" \
	DFS_CLIENT_READ_SHORTCIRCUIT_BUFFER_SIZE="NULL" \
	DFS_DOMAIN_SOCKET_PATH="NULL" \
	FS_PREFIX="hdfs://"

ADD entrypoint.sh ${HDUSER_HOME}/hbase_entrypoint.sh
ADD config_loader.sh ${HDUSER_HOME}/hbase_config_loader.sh

RUN apt-get update && \
    apt-get -y install --no-install-recommends procps \
                                               nano \
                                               wget \
                                               rsync \
                                               gcc \
                                               g++ \
                                               unzip \
                                               iputils-ping \
                                               telnet \
                                               net-tools && \
    rm -rf /var/lib/apt/lists/* && \
    addgroup hadoop && adduser --disabled-password --gecos "" --ingroup hadoop hduser && \
    mkdir -p ${HBASE_HOME} && \
    chown -R hduser:hadoop ${HDUSER_HOME} && \
    chmod +x ${HDUSER_HOME}/hbase_entrypoint.sh ${HDUSER_HOME}/hbase_config_loader.sh
